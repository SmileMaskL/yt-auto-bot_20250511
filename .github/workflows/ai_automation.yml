name: ğŸ¤– AI Video Factory 3.1

on:
  schedule:
    - cron: '0 */4 * * *'  # 4ì‹œê°„ ì£¼ê¸° íŠ¸ë¦¬ê±°
  workflow_dispatch:
    inputs:
      emergency_mode:
        description: "ê¸´ê¸‰ ëª¨ë“œ í™œì„±í™” (true/false)"
        required: false
        default: 'false'

env:
  TZ: Asia/Seoul
  PYTHON_VERSION: '3.10.12'

jobs:
  video-production:
    name: ğŸ¬ AI ë¹„ë””ì˜¤ ìƒì‚° ë¼ì¸
    runs-on: ubuntu-22.04
    timeout-minutes: 55

    steps:
    - name: ğŸ”„ ì €ì¥ì†Œ í´ë¡  (ì „ì²´ íˆìŠ¤í† ë¦¬)
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: ğŸ” ë³´ì•ˆ ê²€ì¦
      run: |
        if [ ! -f "fonts/NotoSansCJKkr-Regular.otf" ]; then
          echo "::error::âŒ í°íŠ¸ íŒŒì¼ ëˆ„ë½"
          exit 1
        fi
        echo "âœ… í•„ìˆ˜ ìì› ê²€ì¦ ì™„ë£Œ"

    - name: ğŸ Python í™˜ê²½ ì„¤ì •
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        cache: 'pip'

    - name: ğŸ“¦ ì¢…ì†ì„± ì„¤ì¹˜
      run: |
        pip install torch==2.3.0+cu121 \
          --extra-index-url https://download.pytorch.org/whl/cu121
        pip install -r requirements.txt

    - name: ğŸš€ AI íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
      env:
        OPENAI_API_KEYS: ${{ secrets.OPENAI_API_KEYS }}
        YOUTUBE_CREDENTIALS: ${{ secrets.YOUTUBE_TOKEN }}
      run: |
        python scripts/main.py \
          --quality 1080p \
          --auto-retry 5 \
          --emergency ${{ inputs.emergency_mode }}

    - name: ğŸ“Š ì‹¤í–‰ ë¦¬í¬íŠ¸ ìƒì„±
      if: always()
      run: |
        python scripts/notifier.py \
          --status ${{ job.status }} \
          --log automation.log
