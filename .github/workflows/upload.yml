# GitHub Actions ìë™í™” ì„¤ì •
name: ğŸ¤– YouTube Video Automation

on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  upload-video:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ”„ Checkout Repository
        uses: actions/checkout@v3

      - name: âœ… í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
        run: |
          echo "OPENAI_API_KEYS_BASE64=${{ secrets.OPENAI_API_KEYS_BASE64 }}" >> $GITHUB_ENV
          echo "GOOGLE_CLIENT_SECRET=${{ secrets.GOOGLE_CLIENT_SECRET }}" >> $GITHUB_ENV
          echo "SLACK_WEBHOOK_URL=${{ secrets.SLACK_WEBHOOK_URL }}" >> $GITHUB_ENV
          echo "ELEVENLABS_API_KEY=${{ secrets.ELEVENLABS_API_KEY }}" >> $GITHUB_ENV
          echo "YOUTUBE_REFRESH_TOKEN=${{ secrets.YOUTUBE_REFRESH_TOKEN }}" >> $GITHUB_ENV

      - name: âœ… API í‚¤ ì‚¬ì „ ê²€ì¦
        run: |
          echo "===== API í‚¤ ì‚¬ì „ ê²€ì¦ ====="
          if [ -z "${{ secrets.OPENAI_API_KEYS_BASE64 }}" ]; then
            echo "âŒ OPENAI_API_KEYS_BASE64 ì‹œí¬ë¦¿ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
            exit 1
          fi

          python -c "import os, base64, json
decoded = base64.b64decode(os.environ['OPENAI_API_KEYS_BASE64']).decode('utf-8')
keys = json.loads(decoded)
assert isinstance(keys, list) and keys, 'âŒ ìœ íš¨í•œ í‚¤ ë¦¬ìŠ¤íŠ¸ê°€ ì•„ë‹™ë‹ˆë‹¤.'
print(f'âœ… ì´ {len(keys)}ê°œì˜ API í‚¤ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.')"

      - name: ğŸ› ï¸ Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: ğŸš€ Run Main Script
        run: python scripts/main.py
