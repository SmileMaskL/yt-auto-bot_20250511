# GitHub Actions ìë™í™” ì„¤ì •
name: ğŸ¤– YouTube Video Automation

on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ íŠ¸ë¦¬ê±°

jobs:
  upload-video:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ”„ Checkout Repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # ì „ì²´ ì»¤ë°‹ íˆìŠ¤í† ë¦¬ ê°€ì ¸ì˜¤ê¸°

      - name: ğŸ Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          cache: 'pip'

      - name: âœ… ì‹œìŠ¤í…œ ì¢…ì†ì„± ì„¤ì¹˜
        run: |
          sudo apt-get update -y
          sudo apt-get install -y \
            ffmpeg \
            libsm6 \
            libxext6 \
            libfontconfig1

      - name: âœ… í°íŠ¸ íŒŒì¼ ê²€ì¦
        run: |
          echo "===== í°íŠ¸ ê²½ë¡œ ê²€ì¦ ====="
          FONT_PATH="fonts/NotoSansCJKkr-Regular.otf"
          if [ ! -f "$FONT_PATH" ]; then
            echo "::error::âŒ í•„ìˆ˜ í°íŠ¸ íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤: $FONT_PATH"
            exit 1
          else
            echo "âœ… í°íŠ¸ íŒŒì¼ í™•ì¸: $(realpath $FONT_PATH)"
          fi

      - name: âœ… í™˜ê²½ë³€ìˆ˜ ì„¤ì •
        run: |
          echo "OPENAI_API_KEYS_BASE64=${{ secrets.OPENAI_API_KEYS_BASE64 }}" >> $GITHUB_ENV
          echo "GOOGLE_CLIENT_ID=${{ secrets.GOOGLE_CLIENT_ID }}" >> $GITHUB_ENV
          echo "GOOGLE_CLIENT_SECRET=${{ secrets.GOOGLE_CLIENT_SECRET }}" >> $GITHUB_ENV
          echo "GOOGLE_REFRESH_TOKEN=${{ secrets.GOOGLE_REFRESH_TOKEN }}" >> $GITHUB_ENV
          echo "ELEVENLABS_KEY=${{ secrets.ELEVENLABS_KEY }}" >> $GITHUB_ENV
          echo "ELEVENLABS_VOICE_ID=${{ secrets.ELEVENLABS_VOICE_ID }}" >> $GITHUB_ENV
          echo "SLACK_API_TOKEN=${{ secrets.SLACK_API_TOKEN }}" >> $GITHUB_ENV
          echo "SLACK_CHANNEL=${{ secrets.SLACK_CHANNEL }}" >> $GITHUB_ENV

      - name: ğŸ› ï¸ Python ì¢…ì†ì„± ì„¤ì¹˜
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: ğŸš€ ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
        run: python scripts/main.py
